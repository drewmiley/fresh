@main("STREAMING") {

    <h1>Loading Stream</h1>

    <div id="data"></div>

    <script type="text/javascript" charset="utf-8">
        // Called for each Comet message
        var streamLoaded = function(data) {
<!--        TODO: NEED To split correctly -->
            const split = document.getElementById('data').innerHTML.split("</div>").map(div => `${div}</div>`);
            const ids = split.map(div => parseInt(div.substr(9, 2)));
            const idsLessThan = ids.filter(id => id < parseInt(data.substr(9, 2))).length;
            document.getElementById('data').innerHTML = split.slice(0, idsLessThan) + data + split.slice(idsLessThan + 1);
<!--            document.getElementById('data').innerHTML += data;-->
        }
    </script>

    <iframe id="comet" src="@routes.FreshController.streamLoad().unique"></iframe>

}
